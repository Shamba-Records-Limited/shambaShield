"use strict";(()=>{var e={};e.id=291,e.ids=[291],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4761:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>q,originalPathname:()=>w,patchFetch:()=>A,requestAsyncStorage:()=>h,routeModule:()=>y,serverHooks:()=>f,staticGenerationAsyncStorage:()=>S,staticGenerationBailout:()=>v});var o={};t.r(o),t.d(o,{GET:()=>m,POST:()=>g});var n=t(5419),a=t(9108),s=t(9678);let i=require("mongoose");var u=t.n(i);let c=process.env.MONGODB_URI;async function p(){if(!(u().connection.readyState>=1))try{await u().connect(c,{useNewUrlParser:!0,useUnifiedTopology:!0}),console.log("✅ Connected to MongoDB Atlas")}catch(e){throw console.error("❌ MongoDB connection error:",e),e}}let d=new(u()).Schema({name:{type:String,required:!0},phone:{type:String,required:!0},email:{type:String,required:!0},county:{type:String,required:!0},region:{type:String,required:!0},gender:{type:String,required:!0},crops:[String],livestock:[String],acreage:{type:String,required:!0},recordKeeping:{type:String,required:!0},insuranceProducts:{type:String,required:!0},monthlyIncome:{type:Number,required:!0},additionalNotes:{type:String,required:!0},createdAt:{type:Date,default:Date.now}}),l=u().models.Farmer||u().model("Farmer",d);async function g(e){await p();try{let r=await e.json(),t=new l({...r,crops:Array.isArray(r.crops)?r.crops:[],livestock:Array.isArray(r.livestock)?r.livestock:[]});return await t.save(),Response.json({message:"Farmer registered successfully"},{status:201})}catch(e){return console.error(e),Response.json({error:e.message},{status:500})}}async function m(){await p();try{let e=await l.find().sort({createdAt:-1});return Response.json(e,{status:200})}catch(e){return console.error(e),Response.json({error:e.message},{status:500})}}let y=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/farmers/route",pathname:"/api/farmers",filename:"route",bundlePath:"app/api/farmers/route"},resolvedPagePath:"/home/shambaShield/app/api/farmers/route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:h,staticGenerationAsyncStorage:S,serverHooks:f,headerHooks:q,staticGenerationBailout:v}=y,w="/api/farmers/route";function A(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:S})}},5419:(e,r,t)=>{e.exports=t(517)}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[638],()=>t(4761));module.exports=o})();